# Aduib RPC configuration template.
# Note: The config loader expects top-level sections under `aduib_rpc` that
# match `src/aduib_rpc/config/models.py`:
# - protocol
# - client
# - resilience
# - security
# - telemetry
# - health_check
# - qos
#
# Environment variable expansion supports the syntax ${VAR:-default}.
# Default values below are sourced from the project's dataclass definitions.

aduib_rpc:
  # Protocol version configuration.
  # See: src/aduib_rpc/config/models.py::ProtocolConfig
  protocol:
    # Supported protocol versions.
    protocol_versions:
      - "1.0"
      - "2.0"
    # Default protocol version to use.
    default_version: "2.0"

  # Client configuration.
  # See: src/aduib_rpc/client/config.py::ClientConfig
  client:
    # Optional: injected httpx.AsyncClient (set in code, not via YAML).
    httpx_client: null

    # Optional: injected gRPC channel factory (set in code, not via YAML).
    grpc_channel_factory: null

    # Allowed transports (grpc | http | jsonrpc | thrift).
    # Empty list means all transports are allowed.
    supported_transports: []

    # Reuse underlying httpx/grpc connections when possible.
    pooling_enabled: true

    # Default HTTP timeout (seconds); set to null to disable.
    http_timeout: 60.0

    # Default gRPC timeout (seconds); set to null to disable.
    grpc_timeout: 60.0

  # Resilience configuration (client-side resilience patterns).
  # See: src/aduib_rpc/resilience/*.py
  resilience:
    # Enable or disable the resilience middleware globally.
    enabled: true

    # Circuit breaker configuration.
    # See: src/aduib_rpc/resilience/circuit_breaker.py::CircuitBreakerConfig
    circuit_breaker:
      # Failures required to open the circuit.
      failure_threshold: 5
      # Successes required to close the circuit from half-open.
      success_threshold: 3
      # Time to stay open before probing (seconds).
      timeout_seconds: 30.0
      # Max in-flight calls allowed in half-open.
      half_open_max_calls: 3
      # Exceptions that do not count as failures (configure in code if needed).
      excluded_exceptions: []

    # Rate limiter configuration.
    # See: src/aduib_rpc/resilience/rate_limiter.py::RateLimiterConfig
    rate_limiter:
      # token_bucket | sliding_window | fixed_window.
      algorithm: token_bucket
      # Tokens/requests per second.
      rate: 100.0
      # Burst capacity for token bucket.
      burst: 150
      # Max time to wait in acquire_or_wait (ms).
      wait_timeout_ms: 1000

    # Retry policy configuration.
    # See: src/aduib_rpc/resilience/retry_policy.py::RetryPolicy
    retry:
      # Maximum retry attempts (>= 1).
      max_attempts: 3
      # fixed | exponential | linear.
      strategy: exponential
      # Initial delay in milliseconds.
      initial_delay_ms: 100
      # Max delay in milliseconds.
      max_delay_ms: 10000
      # Multiplier for backoff growth.
      backoff_multiplier: 2.0
      # Jitter ratio between 0.0 and 1.0.
      jitter: 0.1
      # Retryable numeric error codes; null means retry on any error.
      retryable_codes: null
      # Respect circuit breaker state when retrying.
      respect_circuit_breaker: true

    # Fallback policy (optional). YAML cannot construct handler objects, so keep null
    # unless you inject FallbackPolicy in code.
    fallback: null

    # Optional per-service overrides (application must apply these explicitly).
    service_overrides: {}

  # Security configuration (server-side).
  # See: src/aduib_rpc/server/interceptors/security.py::SecurityConfig
  security:
    # Enable RBAC authorization checks.
    rbac_enabled: true

    # Enable security audit logging.
    audit_enabled: true

    # Default role assigned to unauthenticated principals.
    default_role: anonymous

    # Role name that bypasses checks; set to null to disable.
    superadmin_role: admin

    # Require authentication for all methods unless whitelisted.
    require_auth: false

    # Methods allowed without authentication (suffix match).
    anonymous_methods:
      - health
      - metrics
      - ping

    # mTLS settings for server-side verification.
    # See: src/aduib_rpc/config/models.py::MtlsConfig
    mtls:
      # Enable mutual TLS verification.
      enabled: false

      # TLS configuration used by server-side TLS/mTLS.
      # See: src/aduib_rpc/config/models.py::ServerTlsSettings
      tls:
        # Server certificate path (required for TLS).
        server_cert_path: null
        # Server private key path (required for TLS).
        server_key_path: null
        # Password for encrypted private keys.
        server_key_password: null
        # CA bundle path for client cert verification (mTLS).
        ca_cert_path: null
        # Client cert verification mode (CERT_NONE=0 | CERT_OPTIONAL=1 | CERT_REQUIRED=2).
        client_cert_verification: null
        # Minimum TLS version (TLSv1.2 | TLSv1.3).
        minimum_version: TLSv1.2
        # Maximum TLS version (null means no upper bound).
        maximum_version: null
        # OpenSSL cipher string (optional).
        ciphers: null

      # Allowed subject common names.
      allowed_common_names: []
      # Allowed subject alternative DNS names.
      allowed_san_dns: []
      # Allowed issuer common names.
      allowed_issuer_common_names: []

  # Telemetry configuration (OpenTelemetry-based observability).
  # See: src/aduib_rpc/telemetry/config.py::TelemetryConfig
  telemetry:
    # Enable or disable telemetry globally.
    enabled: true

    # Service name for traces/metrics.
    service_name: aduib-rpc

    # OTLP endpoint (e.g., "http://localhost:4317" for gRPC, "http://localhost:4318" for HTTP).
    otlp_endpoint: http://localhost:4317

    # OTLP protocol (grpc | http/protobuf).
    otlp_protocol: grpc

    # Tracing configuration.
    tracing_enabled: true
    instrument_fastapi: true
    instrument_httpx: true
    instrument_grpc: true

    # Metrics configuration.
    metrics_enabled: true
    metrics_export_interval_ms: 30000

    # Logging configuration.
    logging_enabled: true
    log_level: INFO
    log_format: json

    # Audit configuration.
    audit_enabled: true
    audit_include_params: false
    audit_include_response: false

  # Health check configuration (service discovery).
  # See: src/aduib_rpc/discover/health/health_status.py::HealthCheckConfig
  health_check:
    # Interval between health checks (seconds).
    interval_seconds: 10.0
    # Per-check timeout (seconds).
    timeout_seconds: 5.0
    # Consecutive successes to mark healthy.
    healthy_threshold: 2
    # Consecutive failures to mark unhealthy.
    unhealthy_threshold: 3
    # Health endpoint path for HTTP checks.
    path: /health

  # QoS (Quality of Service) configuration.
  # See: src/aduib_rpc/protocol/v2/qos.py::QosConfig
  qos:
    # Enable or disable QoS enforcement.
    enabled: false

    # Default priority (0=LOW, 1=NORMAL, 2=HIGH, 3=CRITICAL).
    priority: 1

    # Default timeout in milliseconds.
    timeout_ms: 60000

    # Default idempotency key (null means auto-generate per request).
    idempotency_key: null

    # Idempotency cache TTL in seconds.
    idempotency_ttl_s: 300

    # Optional retry policy for QoS-managed requests.
    retry:
      max_attempts: 3
      strategy: exponential
      initial_delay_ms: 100
      max_delay_ms: 10000
